---
title: "Markdown Magic"
author: "Juli Tkotz"
date: "16 April 2019"
output: 
  pdf_document:
    highlight: tango
bibliography: ["some_refs.bib"]
header-includes:
 - \usepackage{booktabs}
---

## Some rmarkdown basics

### Chunk options

We include code chunks in our document. We can specify the default chunk options using the `knitr` package which spares you some annoying copy-pasting. You can override them for individual chunks, though! Here, I want the raw code to be shown, so I set `echo = TRUE`. I also want the code to be executed, so I set `include = TRUE`. I also like to live dangerously and want to supress (?) any warning messages. And I'd like my figures to be centered.

```{r setup}
knitr::opts_chunk$set(echo = TRUE, include = TRUE, message = FALSE, 
                      warning = FALSE, fig.align = "center")
```


Example: `echo = TRUE` and `include = TRUE`:

```{r}
print("I like lasagna.")
```


Compared to: `echo = FALSE` and `include = TRUE`:

```{r echo = FALSE}
print("I like lasagna.")
```


Compared to: `echo = TRUE` and `include = FALSE`:

```{r echo = TRUE, include = FALSE}
print("I like lasagna.")
```

### Inline code

Let's get some data first. `R` and some of its packages come with some built-in data sets. We'll use the diamonds data set.

```{r}
library(tidyverse)
diamonds <- diamonds
```

```{r}
# We only have a "normal" PDF document here, but check the papaja package for 
# an APA template and e.g. tables in APA format
# Don't forget to set results = 'asis'
# We also need the package booktabs in the header
library(xtable)

diamonds_table <- head(diamonds)
```

```{r results = 'asis'}
print(xtable(diamonds_table, comment = FALSE, include.rownames = FALSE, 
             booktabs = TRUE))
```

Now, let's have some truly sparkling (get it?) markdown magic. You can throw code into your text that is directly executed. Use backticks and specify `R` as language (see .Rmd-file for how the code looks like). So, for example, we can include this code ...

```{r}
round(mean(diamonds$price), 2)
```


... directly in our text, which looks like this: `r round(mean(diamonds$price), 2)`. That comes in really handy when reporting statistics because you can just change the data source and all means, standard deviations and stuff you have in your text will change with it. 

#### Printing statistical results
There are also packages which make printing of results from statistical tests easier. For example, if we run a t-test (and calculate the effect size) on the price difference between fair (lowest level) and ideal (highest level) diamonds, we can print the output readily (?) formatted (?) in APA style.

```{r}
t_cut_price <- t.test(diamonds$price[diamonds$cut == "Fair"], 
                      diamonds$price[diamonds$cut == "Ideal"])

library(effsize)

d_cut_price <- cohen.d(diamonds$price[diamonds$cut == "Fair"],
                       diamonds$price[diamonds$cut == "Ideal"])
```

```{r}
# devtools, git and stuff
library(prmisc)

# Packages that are not released on CRAN, but in GitHub repositories, can be
# downloaded with the aid of the package devtools. In this case, the code would 
# look like this:
# 
# library("devtools")
# install_github("m-Py/prmisc")
```

It appears that the ideal cut diamonds `r print_mean_sd(diamonds$price[diamonds$cut == "Ideal"])` are pricier than the fair cut ones `r print_mean_sd(diamonds$price[diamonds$cut == "Fair"])`, `r print_ttest(t_cut_price, d_cut_price)`.

## Citations
There is a vast amount of packages offering functions like this. I just shamelessly promote this one because it is from @R-prmisc and I contributed a bit. Also, it is a nice example to show you how citations work. You can see that we included a nice little .bib-file in our header. Now, we can just call citations by calling $@$[^escape], following the name I gave the reference: `@R-prmisc`

[^escape]: Latex is extremly picky about inserting a simple at symbol in text. Usually, escaping special characters with \\ does the trick (in fact, I had to escape the \\ itself), but not in this case. Wrapping it in dollar signs (= "math mode") works, but it's a dirty hack.

Without brackets, it looks like what you saw above. Some brackets `[]` make it look like this [@R-prmisc]. It's always nice to cite the software you used! If you want to cite a package, you can get its citation in bibtex format by calling, `toBibtex(citation("prmisc"))` (with the name of the package that you want, obviously). Don't forget to give the reference a name when you save it in your .bib-file. Use ; within brackets to cite multiple sources [@kable_2007; @green_1981]. In a normal PDF document, references in text don't always follow APA guidelines, but when you use a `papaja` template, the package will work stuff out for you.

# References